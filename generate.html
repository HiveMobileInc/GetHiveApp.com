<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Hive | Create your Hive</title>
        <meta charset="UTF-8" />
        <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="description" content="Enable Conversations everywhere with Hive: Generate your conversation link now."/>
        <meta property="og:title" content="Enable Conversations Anywhere - Generate yours now."/>
        <meta property="og:site_name" content="Hive"/>
        <meta property="og:description" content="Enable Conversations everywhere with Hive: An intuitive communication platform that works in every situation, and on device and operating system. Generate your conversation link now."/>
        <meta property="og:url" content="//hivemobileinc.github.io/GetHiveApp.com/">
        <meta property="og:image" content="//hivemobileinc.github.io/GetHiveApp.com/img/hive_logo_blue.png"/>
        <meta property="og:type" content="website" />
        <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600' rel='stylesheet' type='text/css'/>
        <link rel="shortcut icon" href="img/favicon.ico"/>
        <link rel="stylesheet" type="text/css" href="css/generate.css"/>
    </head>
    <body>
        <img src="img/bg-full.jpg" class="bg" alt=""/>

        <section class="landing generate">
            <div class="container">
                <a href="http://gethiveapp.com"><img class="logo" src="img/logo-w.png" alt="Hive logo"/></a>
                <h1>Create a Conversation!</h1>
            </div>
        </section>

        <section class="generate-link">
            <div class="container">
                <div class="generate col-xxs-12 col-xs-6 col-xs-offset-3 col-lg-4 col-lg-offset-4">
                    <div id="con-main" class="top">
                        <span id="regin" class="regin none">
                            <div id="regin-err" class="regin-err none"></div>
                            <div class="field">
                                <input id="username" class="form-control" type="text" name="username" placeholder="username"/>
                            </div>
                            <div class="field">
                                <input id="password" class="form-control" type="password" name="password" placeholder="password"/>
                            </div>
                            <button id="btn-regin" class="btn send">
                                Login or Register
                            </button>
                        </span>

                        <span id="load" class="" style="text-align:center;">
                            <i class="fa fa-refresh fa-spin"></i>
                        </span>

                        <span id="gen" class="none">
                            <input id="inp-title" type="text" placeholder="Choose a title" class="form-control hve-name"/>
                            <p id="dsc-pub" class="desc public">
                                <i class="fa fa-globe"></i>This conversation can be viewed by anyone.
                            </p>
                            <button id="btn-create" class="send col-xs-12">Create 
                                <span id="txt-title">Your Conversation</span>
                            </button>
                        </span>
                    </div>
                    
                    <div id="con-gen" class="bottom none">
                        <div class="hve-link col-xs-12" style="text-align:center;">
                            <span id="gen-url" onclick="return highlight(this);">https://see.rest/URL</span>
                        </div>
                        <p class="desc">
                          <i class="fa fa-comment"></i>Copy-paste this link anywhere to start the conversation! Or <a id="gen-url2" href="#" target="_blank">click here to start it yourself!</a>
                        </p>
                        <p class="desc hve-warning">
	                        <i class="fa fa-info-circle"></i>Note: All conversations will be deleted Dec. 1st 2014 to support the Hive Beta. <br><a href="http://gethiveapp.com/dev">Click here</a> for more information.
                        </p>
                    </div>
                </div>
                <div id="logout" class="hve-logout none">
                    <span>Logged in as <a id="in-user" href="#"></a></span>
                    <a href="#" style="color:white;" onclick="return logout();">Logout</a>
                </div>
            </div>
        </section>

        <script src="js/min/index-min.js"></script>
        <script src="https://s3.amazonaws.com/hvejs/hve.min.js"></script>
        <script type="text/javascript">

            var button_register = $('#button-register');
            var button_login = $('#button-login');
            var text_register = $('#register-text');
            var text_login = $('#login-text');
            var logout_link = $('#logout');
            var btn_pub = $('#btn-pub');
            var btn_pri = $('#btn-pri');
            var dsc_pub = $('#dsc-pub');
            var dsc_pri = $('#dsc-pri');
            var txt_title = $('#txt-title');
            var txt_title_start = txt_title.text();
            var inp_title = $('#inp-title');
            var btn_create = $('#btn-create');
            var username = $('#username');
            var password = $('#password');
            var loader = $('#load');
            $('#btn-regin').click(regin_click);
            var con_regin = $('#regin');
            var gen = $('#gen');
            var con_main = $('#con-main');
            var con_gen = $('#con-gen');
            var gen_url = $('#gen-url');
            var gen_url2 = $('#gen-url2');
            var in_user = $('#in-user');
            var regin_err = $('#regin-err');

            button_register.click(function () {
                button_register.addClass('selected');
                button_login.removeClass('selected');
                text_register.removeClass('none');
                text_login.addClass('none');
            });
            button_login.click(function () {
                button_register.removeClass('selected');
                button_login.addClass('selected');
                text_register.addClass('none');
                text_login.removeClass('none');
            });
            btn_pub.click(function () {
                btn_pub.addClass('selected');
                dsc_pub.removeClass('none');
                btn_pri.removeClass('selected');
                dsc_pri.addClass('none');
            });
            btn_pri.click(function () {
                btn_pub.removeClass('selected');
                dsc_pub.addClass('none');
                btn_pri.addClass('selected');
                dsc_pri.removeClass('none');
            });
            inp_title.keyup(function (e) {
                var l = inp_title.val().length;
                if (l == 0) 
                    txt_title.text(txt_title_start);
                else 
                    txt_title.text(l > 21 ? inp_title.val().substr(0, 21) + '...' : inp_title.val());
                if (e.keyCode == 13)
                    return btn_create.click();
            });
            btn_create.click(function () {
                create_conversation(null, inp_title.val(), 'public', function (err, bdy) {
                    if (err) throw err;
                    generated(bdy);
                });
                return false;
            });

            function generated (bdy) {
                con_main.addClass('none');
                con_gen.removeClass('none');
                btn_create.addClass('none');
                gen_url.text(bdy.created.url_short);
                gen_url2.attr('href', bdy.created.url_short);
                setTimeout(function () {highlight(document.getElementById('gen-url'));}, 10);
            };

            function highlight (e) {
                var range;
                var selection;    
                if (document.body.createTextRange) {
                    range = document.body.createTextRange();
                    range.moveToElementText(e);
                    range.select();
                } else if (window.getSelection) {
                    selection = window.getSelection();        
                    range = document.createRange();
                    range.selectNodeContents(e);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
                return false;
            }
            username.keyup(function (e) {
                if (e.keyCode == 13) {
                    password.focus();
                    return false; 
                }
            });
            password.keyup(function (e) {
                if (e.keyCode == 13)
                    return regin_click();
            });

            function regin_click () {
                function logged_in () {
                    logout_link.removeClass('none');
                    loader.addClass('none');
                    con_regin.addClass('none');
                    gen.removeClass('none');
                    inp_title.focus();
                    in_user.text(bndl.profile.display_name)
                           .attr('href', root + 'user/' + bndl.profile.username);
                };
                con_regin.addClass('none');
                loader.removeClass('none');
                if (bndl == null) {
                    regin(username.val(), password.val(), function (err, creds) {
                        if (err) {
                            loader.addClass('none');
                            con_regin.removeClass('none');
                            regin_err.text(err).removeClass('none');
                            throw err;
                        }
                        logged_in();
                    });
                } else logged_in();
                return false;
            };
            function logout () {
                bndl = null;
                localStorage.removeItem('hvebndl');
                location.reload();
                return false;
            };
            function hve_loaded () {
                if (bndl != null) regin_click();
                else {
                    con_regin.removeClass('none');
                    loader.addClass('none');
                }
            };
        </script>
    </body>
</html>