function close_welcome(){welcomer.addClass("none");return false}function hve_loaded(){if(bndl!=null)regin_click();get_conversation_perm(url,function(e,t){if(e){err_show.text("An error occured: "+e).removeClass("none");main_con.addClass("none");throw e}perm_store=t;hive_title.text(t.title);document.title="Hive | "+t.title;short_url_link.attr("href",t.url_short);short_url_link.text(t.url_short);modal_short_url.text(t.url_short);modal_short_url.attr("href",t.url_short);get_conversation_base(url,function(e,t){if(e)throw e;if(t.length==0)welcomer.removeClass("none");hve_load.addClass("none");if(t.length==page_size)earlier.removeClass("none");for(var n=0;n<t.length;n++)add_msg(t[n],false);setTimeout(hve_newer,heart)},true)},true)}function show_regin(){if(bndl!=null)return post_as_user();hve_regin.removeClass("none");html_body.animate({scrollTop:hve_regin.offset().top-30},200);username.focus();return false}function regin_click(){function e(){logout_link.removeClass("none");regin_icon.attr("class","fa fa-comment-o");btn_user_text.text(bndl.profile.display_name);return false}if(bndl==null){regin(username.val(),password.val(),function(t,n){if(t)throw t;hve_regin.addClass("none");html_body.animate({scrollTop:msg_entry.offset().top-window.innerHeight/3},200);msg_entry.focus();return e()})}else return e()}function logout(){bndl=null;localStorage.removeItem("hvebndl");logout_link.addClass("none");regin_icon.attr("class","fa fa-sign-in");btn_user_text.text("Register or Login");return false}function toggle_rep(e){var t=$("#"+e);t.toggleClass("none");return false}function add_msg(e,t){var n=msg_tmp.split("HID").join(hop++).split("MID").join(e.mid).split("HMSG").join(e.message).split("HDISPLAYNAME").join(e.author.display_name).split("HCREATEDAGO").join(e.created_ago);if(t)new_mrk.before(n);else old_mrk.after(n)}function disable_post(){msg_entry.prop("disabled",true);hve_regin.prop("disabled",true);btn_post_user.prop("disabled",true);btn_post_guest.prop("disabled",true)}function enable_post(e){msg_entry.prop("disabled",false);hve_regin.prop("disabled",false);btn_post_user.prop("disabled",false);btn_post_guest.prop("disabled",false);if(e)msg_entry.val("");msg_entry.focus()}function post_as_user(){disable_post();post_message(url,msg_entry.val(),null,null,posted,false);return false}function post_as_guest(){disable_post();post_message(url,msg_entry.val(),null,null,posted,true);return false}function posted(e,t){if(e){enable_post(false);throw e}for(var n=0;n<t.length;n++){conv.splice(0,0,t[n]);add_msg(t[n],true)}enable_post(true)}function hve_earlier(){earlier.addClass("none");earlier_load.removeClass("none");get_older_messages(url,function(e,t){earlier_load.addClass("none");if(e||t.length==page_size)earlier.removeClass("none");if(e)throw e;for(var n=0;n<t.length;n++)add_msg(t[n],false)});return false}function hve_newer(){get_newer_messages(url,function(e,t){if(e){throw e;return setTimeout(hve_newer,heart)}if(t.length==0)return setTimeout(hve_newer,heart);new_cache=new_cache.concat(t);if(clicked_new){show_new();return setTimeout(hve_newer,500)}newlink.removeClass("none");newtext.text("Show "+new_cache.length+" new message"+(new_cache.length==1?"":"s"));if(t.length==page_size)return setTimeout(hve_newer,500);else return setTimeout(hve_newer,heart)})}function show_new(){clicked_new=true;for(var e=0;e<new_cache.length;e++)add_msg(new_cache[e],true);new_cache=[];newlink.addClass("none");return false}function report_msg(e,t,n){$("#"+n).attr("class","none").before("<p><i>Thank you for reporting this message, humans will review it shortly.</i></p>");report_message(url,e,t,function(e,t){if(e)throw e});return false}function submod(){pst("rye?",{name:sub_name.val(),email:sub_email.val()},function(e,t){if(e)throw e;mod_body.addClass("none");mod_good.removeClass("none")});return false}$("#type").tooltip();var heart=5e3;var welcomer=$("#welcomer");var short_url_link=$("#short-url");var modal_short_url=$("#modal-short-url");var logout_link=$("#logout");var username=$("#username");var password=$("#password");var hive_title=$("#hve-title");var msg_tmp=$("#msg-tmp").html();var old_mrk=$("#msg-tmp");var new_mrk=$("#new-mrk");var msg_entry=$("#hve-message");msg_entry.focus();var earlier=$("#hve-earlier");var earlier_load=$("#hve-earlier-load");var newlink=$("#hve-new-text");var newtext=$("#hve-new-text");var mod_body=$("#mod-body");var mod_good=$("#mod-good");var sub_name=$("#sub-name");var sub_email=$("#sub-email");var err_show=$("#err");var main_con=$("#main-con");var hve_load=$("#hve-load");var hve_regin=$("#hve-regin");var html_body=$("html, body");var regin_icon=$("#regin-icon");var btn_user_text=$("#btn-user-text");var btn_post_user=$("#btn-post-user");var btn_post_guest=$("#btn-post-guest");username.keyup(function(e){if(e.keyCode==13){password.focus();return false}});password.keyup(function(e){if(e.keyCode==13)return regin_click()});sub_name.keyup(function(e){if(e.keyCode==13){sub_email.focus();return false}});sub_email.keyup(function(e){if(e.keyCode==13)return submod()});var perm_store;var hop=1;var new_cache=[];var clicked_new=false;